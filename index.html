<!doctype html><html class="no-js" lang=""><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Generative Garden</title>
    <meta name="description" content="A garden generated by computer rules.">
</head>
<body class="
             bg-neutral-800
             h-screen
             flex flex-col justify-center items-center
             m-4
             "
_="
def makeSVGElement(tag)
    call document.createElementNS('http://www.w3.org/2000/svg', tag)
    return the result
end

"
>

<svg
viewBox="0 0 16 9"
stroke-width="0.1"
class="
  w-1/2
  aspect-video
  bg-neutral-100/20
  "
_="
init
    set viewBox to (my @viewBox).split(' ')
    set :minX to viewBox[0]
    set :minY to viewBox[1]
    set :maxX to viewBox[2]
    set :maxY to viewBox[3]
    set :midX to (:minX + :maxX) / 2
    set :midY to (:minY + :maxY) / 2
    set :aspectRatio to :midX / :midY
    set my @stroke-width to :aspectRatio / 30

    -- Use stroke width as the finest detail line
    set :finest to my @stroke-width

    set :time to value of <input[data-time] />
    set :theta to value of <input[data-theta] />
end

on 'time updated'(t)
    set :time to t
    trigger 'repaint everything'
end

on 'theta updated'(d)
    set :theta to d
    trigger 'repaint everything'
end

on 'repaint everything'
    trigger clear
    trigger 'draw debug marks'(classes: 'fill-transparent stroke-none')
    trigger 'draw grass'(d: :theta, t: :time)
end

on clear
  set my innerHTML to ''
end

on 'draw debug marks'(classes)
  repeat for coords in [
      [ :minX, :minY ],
      [ :minX, :maxY ],
      [ :maxX, :maxY ],
      [ :maxX, :minY ]
    ]
    makeSVGElement('circle')
    put coords[0] into its @cx
    put coords[1] into its @cy
    put 0.5 into its @r
    put classes into its @class
    put it at the end of me
  end

  makeSVGElement('rect')
  put :midX - 0.5 into its @x
  put :midY - 0.5 into its @y
  put 1 into its @width
  put 1 into its @height
  put classes into its @class
  put it at the end of me
end

on 'draw grass'(d, t)
  set age to t / 100  -- time / max age
  set instructions to []
  instructions.push(`M ${:midX} ${:maxY}`)
  instructions.push(`V ${:maxY - (age * :midY)}`)

  set agePastMiddle to age - 0.5
  if agePastMiddle is greater than 0
    instructions.push(`l ${(:theta * :finest) * agePastMiddle} ${agePastMiddle * -:midY}`)
  end

  set agePastOld to age - 0.75
  if agePastOld is greater than 0
    instructions.push(`l ${((:theta * :finest) * agePastOld) * 2} ${agePastOld * -:midY}`)
  end

  instructions.push(`L ${:midX} ${:maxY - (age * :midY)}`)


  instructions.push(`Z`)

  makeSVGElement('path')
  set its @d to instructions.join(' ')
  put 'fill-green-100 stroke-green-100' into its @class
  put it at the end of me
end

"
    >
    </svg>

    <div
        class="
               bg-neutral-100/40
               mt-4 p-4
               gap-4
               flex flex-col justify-between items-start
               ">
        <h2>Controls</h2>
        <label class="text-sm flex justify-between items-center w-full gap-1">
            Time from
            0 to 100
            <input
                data-time
                type="range" min="0" max="100" step="0.5" value="50"
                _="
                      init
                          send 'time updated'(t: my value) to <svg />
                      end

                      on 'time updated'(t)
                        put t into my value
                        put t into the value of the next <input />
                      end

                      on input
                          put my value into the value of the next <input />
                          send 'time updated'(t: my value) to <svg />
                      "
            />
            <input
                class="inline-block w-16 text-center bg-neutral-100/40 rounded-md pt-0.5 pl-4 bs focus:pl-1"
                type="number" value="50" step="0.5" min="0" max="100"
                _="on input
                       send 'time updated'(t: my value) to previous <input />
                       send 'time updated'(t: my value) to <svg />
                       "
            />
        </label>

        <label class="text-sm flex justify-between items-center w-full gap-1">
            Theta (d) from 0 to 100
            <input
                data-theta
                type="range" min="0" max="100" step="0.5" value="50"
                _="
                      init
                          send 'theta updated'(d: my value) to <svg />
                      end

                      on 'theta updated'(d)
                        put d into my value
                        put d into the value of the next <input />
                      end

                      on input
                          put my value into the value of the next <input />
                          send 'theta updated'(d: my value) to <svg />
                      "
            />
            <input
                class="inline-block w-16 text-center bg-neutral-100/40 rounded-md pt-0.5 pl-4 bs focus:pl-1"
                type="number" value="50" step="0.5" min="0" max="100"
                _="on input
                       send 'theta updated'(d: my value) to previous <input />
                       send 'theta updated'(d: my value) to <svg />
                       "
            />
        </label>

        <label class="hidden">
            Continuously loop time from 0 to 100
            <button

            >Play</button>
            <button class="hidden">Pause</button>
            <button class="hidden">Pause</button>
        </label>
    </div>

<script>
 const { log } = window.console;
 log("Loading JavaScript...")
 // I don't care about warnings, until they grow in number.
 const warnings = []; window.console = {...console, warn: (...messages) => {warnings.push(messages);}}; setTimeout(() => console.log(`Warnings on startup: ${warnings.length}`, warnings), 2000)
 log(`JavaScript loaded.`);
</script>
<script src="https://unpkg.com/hyperscript.org@0.9.7"></script>
<script src="https://cdn.tailwindcss.com"></script>
</body></html>
